<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TIGINSA — Fil d’actualité</title>
<style>
:root {
  --bg:#0f1724; --card:#0b1220; --muted:#9aa8bf; --accent:#5eead4;
  --radius:12px; --shadow:0 6px 18px rgba(2,6,23,0.6);
  font-family: Inter, sans-serif;
}
* { box-sizing:border-box; margin:0; padding:0; }

body {
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  background: linear-gradient(135deg,#071226,#0f1724);
  color:#e6eef8;
  font-size:16px;
  padding:20px;
}

.container {
  background:var(--card);
  padding:32px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  width:100%;
  max-width:1100px;
}

.header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:16px;
}

.header-left {
  text-align:center;
  flex:1;
}

.header-right a {
  display:flex;
  align-items:center;
  gap:8px;
  color:var(--accent);
  text-decoration:none;
  font-weight:600;
}

.header-right a img {
  width:60px;
  height:auto;
  border-radius:50%;
  cursor:pointer;
  transition: transform 0.3s ease, filter 0.3s ease;
}

.header-right a:hover img {
  transform: scale(1.05);
  filter: drop-shadow(0 0 8px var(--accent));
}

.header-right a:hover span { text-decoration:underline; }

.logo { display:block; margin:0 auto 16px auto; width:200px; height:auto; }
.logo:hover { transform: scale(1.05); filter: drop-shadow(0 0 12px var(--accent)); }

.search-bar { margin:16px 0; display:flex; justify-content:center; }
.search-bar input[type="text"] {
  padding:10px 12px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.1);
  background:transparent;
  color:#e6eef8;
  outline:none;
  width:300px;
}

h1, h2 { color:var(--accent); margin-bottom:16px; }

.feed-container { display:grid; grid-template-columns:1fr 1fr; gap:24px; }

.feed {
  background:rgba(255,255,255,0.03);
  border-radius:var(--radius);
  padding:16px;
  box-shadow:var(--shadow);
  max-height:600px;
  overflow-y:auto;
}

.post {
  padding:12px;
  border-bottom:1px solid rgba(255,255,255,0.1);
  margin-bottom:12px;
  border-radius:8px;
  background:rgba(255,255,255,0.02);
  cursor:pointer;
  position:relative;
}

.post strong { color: var(--accent); }

.post p { margin:6px 0; }

.like-btn {
  position:absolute;
  top:12px;
  right:12px;
  background:none;
  border:none;
  color:#ffffff;
  cursor:pointer;
  font-size:18px;
  display:flex;
  align-items:center;
  gap:6px;
  transition:color 0.2s ease;
  z-index:1;
}

.like-btn.liked { color:#f87171; }
.like-btn:hover { color:#f87171; }

form { display:flex; flex-direction:column; gap:16px; margin-bottom:32px; }

textarea {
  padding:10px 12px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.1);
  background:transparent;
  color:#e6eef8;
  outline:none;
  width:100%;
  min-height:80px;
}

button {
  padding:12px;
  background:linear-gradient(90deg,#06b6d4,#7c3aed);
  border:none;
  border-radius:8px;
  color:#021024;
  font-weight:700;
  cursor:pointer;
  transition:0.2s;
}

button:hover { opacity:0.9; }

a { color:var(--accent); text-decoration:none; }
a:hover { text-decoration:underline; }

@media (max-width:900px) { .feed-container { grid-template-columns:1fr; } }
</style>
</head>
<body>
<div class="container">

  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <img src="{{ url_for('static', filename='tiger.png') }}" alt="Logo TIGINSA" class="logo">
      <h1>Bienvenue, {{ username }}</h1>
    </div>
    <div class="header-right">
      <a href="{{ url_for('profile', username=username) }}">
        <img src="{{ url_for('static', filename='tiger.png') }}" alt="Profil">
        <span>Mon profil</span>
      </a>
    </div>
  </div>

  <!-- Barre de recherche -->
  <div class="search-bar">
    <form method="GET" action="{{ url_for('search') }}">
      <input type="text" name="q" placeholder="Rechercher des utilisateurs..." required>
    </form>
  </div>

  <!-- Formulaire publier un tweet -->
  <form method="POST" action="{{ url_for('tweet') }}">
    <textarea name="content" placeholder="Quoi de neuf ?" required></textarea>
    <button type="submit">Publier</button>
  </form>

  <div class="feed-container">
    <!-- Abonnements -->
    <div class="feed">
      <h2>Vos abonnements</h2>
      {% if following_feed %}
        {% for post in following_feed %}
          <div class="post" onclick="window.location.href='{{ url_for('profile', username=post.username) }}'" data-post-id="{{ post.id }}">
            <strong>{{ post.username }}</strong>
            <p>{{ post.content }}</p>
            <button class="like-btn {% if post.liked %}liked{% endif %}" onclick="event.stopPropagation();">
              ❤️ <span class="like-count">{{ post.likes }}</span>
            </button>
          </div>
        {% endfor %}
      {% else %}
        <p style="text-align:center; color:var(--muted);">Aucun tweet à afficher.</p>
      {% endif %}
    </div>

    <!-- Recommandations -->
    <div class="feed">
      <h2>Recommandations</h2>
      {% if recommended_feed %}
        {% for post in recommended_feed %}
          <div class="post" onclick="window.location.href='{{ url_for('profile', username=post.username) }}'" data-post-id="{{ post.id }}">
            <strong>{{ post.username }}</strong>
            <p>{{ post.content }}</p>
            <button class="like-btn {% if post.liked %}liked{% endif %}" onclick="event.stopPropagation();">
              ❤️ <span class="like-count">{{ post.likes }}</span>
            </button>
          </div>
        {% endfor %}
      {% else %}
        <p style="text-align:center; color:var(--muted);">Aucune recommandation pour le moment.</p>
      {% endif %}
    </div>
  </div>

  <!-- Déconnexion -->
  <p style="text-align:center; margin-top:24px;">
    <a href="{{ url_for('logout') }}">Déconnexion</a>
  </p>

</div>

<script>
// Gestion likes (AJAX)
document.querySelectorAll('.like-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const post = btn.closest('.post');
    const postId = post.dataset.postId;
    const countEl = btn.querySelector('.like-count');
    let count = parseInt(countEl.textContent);

    if(btn.classList.contains('liked')){
      btn.classList.remove('liked');
      countEl.textContent = count - 1;
    } else {
      btn.classList.add('liked');
      countEl.textContent = count + 1;
    }

    fetch(`/like/${postId}`, { method:'POST' });
  });
});
</script>
</body>
</html>
