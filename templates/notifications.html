<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TIGINSA ‚Äî Notifications</title>
<style>
:root {
  --bg:#0f1724; --card:#0b1220; --muted:#9aa8bf; --accent:#5eead4;
  --radius:12px; --shadow:0 6px 18px rgba(2,6,23,0.6);
  font-family: Inter, sans-serif;
}
* { box-sizing:border-box; margin:0; padding:0; }

body {
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  background: linear-gradient(135deg,#071226,#0f1724);
  color:#e6eef8;
  font-size:16px;
  padding:20px;
}

.container {
  background:var(--card);
  padding:32px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  width:100%;
  max-width:800px;
}

/* HEADER */
.header-top {
  display:flex;
  justify-content:flex-end;
  align-items:center;
  gap:16px;
  margin-bottom:24px;
}

.notif-shortcut, .profile-shortcut {
  display:flex;
  align-items:center;
  gap:10px;
  text-decoration:none;
  color:var(--accent);
  font-weight:600;
}
.notif-shortcut svg, .profile-shortcut svg {
  width:50px;
  height:50px;
  cursor:pointer;
  transition: transform 0.3s ease, filter 0.3s ease;
}
.notif-shortcut:hover svg, .profile-shortcut:hover svg {
  transform: scale(1.05);
  filter: drop-shadow(0 0 12px var(--accent));
}

/* TITRE */
h1 {
  color:var(--accent);
  text-align:center;
  margin-bottom:24px;
}

/* LISTE NOTIFICATIONS */
.notifications-list {
  display:flex;
  flex-direction:column;
  gap:16px;
}

.notification {
  background: rgba(94,234,212,0.05);
  padding:16px;
  border-radius:var(--radius);
  display:flex;
  justify-content:space-between;
  align-items:center;
  transition: background 0.2s;
}

.notification-original {
  margin-top: 4px;
  color: var(--muted);
  font-size: 14px;
  padding-left: 10px;
  border-left: 2px solid rgba(156, 163, 175, 0.5);
  background: rgba(255, 255, 255, 0.03);
  padding: 8px;
  border-radius: 4px;
  margin-bottom: 4px;
}

.notification-content {
  margin-top: 4px;
  color: var(--accent);
  font-size: 14px;
  padding-left: 10px;
  border-left: 2px solid rgba(94, 234, 212, 0.5);
  background: rgba(94, 234, 212, 0.05);
  padding: 8px;
  border-radius: 4px;
}

.notification:hover {
  background: rgba(94,234,212,0.15);
}

.notification-text {
  display:flex;
  flex-direction:column;
}
.notification-text a {
  color: var(--accent);
  text-decoration: none;
}
.notification-text a:hover {
  text-decoration: underline;
}

.notification-time {
  font-size: 12px;
  color: var(--muted);
}

/* Boutons */
.view-tweet-btn {
  padding:8px 12px;
  background: linear-gradient(90deg,#06b6d4,#7c3aed);
  border:none;
  border-radius:8px;
  color:#021024;
  font-weight:600;
  cursor:pointer;
  transition:0.2s;
  text-decoration:none;
}
.view-tweet-btn:hover {
  opacity:0.9;
}
</style>
</head>
<body>
<div class="container">

  <!-- HEADER -->
  <div class="header-top">
    <a href="{{ url_for('routes.feed') }}" class="notif-shortcut" title="Retour au feed">
      üîô Feed
    </a>
    <a href="{{ url_for('routes.profile', username=current_user.username) }}" class="profile-shortcut">
      Profil
    </a>
  </div>

  <h1>Mes notifications</h1>
  {% if notifications %}
<div class="notifications-list">
  {% for notif in notifications %}
  <div class="notification">
    <div class="notification-text">
      {% if notif.type == 'like' %}
        <span>
          <a href="{{ url_for('routes.profile', username=notif.from_user_username) }}">
            {{ notif.from_user_username }}
          </a> a aim√© votre tweet.
        </span>
      {% elif notif.type == 'comment' %}
        <span>
          <a href="{{ url_for('routes.profile', username=notif.from_user_username) }}">
            {{ notif.from_user_username }}
          </a> a comment√© votre tweet : "{{ notif.content }}"
        </span>
      {% elif notif.type == 'retweet' %}
        <span>
          <a href="{{ url_for('routes.profile', username=notif.from_user_username) }}">
            {{ notif.from_user_username }}
          </a> a retweet√© votre tweet.
        </span>
      {% elif notif.type == 'follow' %}
        <span>
          <a href="{{ url_for('routes.profile', username=notif.from_user_username) }}">
            {{ notif.from_user_username }}
          </a> vous suit maintenant.
        </span>
      {% elif notif.type == 'reply' %}
        <span>
          <a href="{{ url_for('routes.profile', username=notif.from_user_username) }}">
            {{ notif.from_user_username }}
          </a> a r√©pondu √† votre commentaire.
        </span>
        {% if notif.content %}
          {# Parse the formatted content string #}
          {% set content_str = notif.content %}
          {% set original_comment = '' %}
          {% set reply_content = '' %}
          
          {# Find REPLY_TO part #}
          {% if 'REPLY_TO:' in content_str %}
            {% set parts = content_str.split('|') %}
            {% if parts|length >= 2 %}
              {# Extract REPLY_TO part #}
              {% set reply_to_part = parts[0] %}
              {% set original_comment = reply_to_part[9:] %}  {# Remove 'REPLY_TO:' #}
              
              {# Remove surrounding quotes #}
              {% if original_comment.startswith("'") and original_comment.endswith("'") %}
                {% set original_comment = original_comment[1:-1] %}
              {% elif original_comment.startswith("\u0027") and original_comment.endswith("\u0027") %}
                {% set original_comment = original_comment[6:-6] %}
              {% endif %}
              
              {# Extract REPLY part #}
              {% set reply_part = parts[1] %}
              {% set reply_content = reply_part[6:] %}  {# Remove 'REPLY:' #}
              
              {% if reply_content.startswith("'") and reply_content.endswith("'") %}
                {% set reply_content = reply_content[1:-1] %}
              {% elif reply_content.startswith("\u0027") and reply_content.endswith("\u0027") %}
                {% set reply_content = reply_content[6:-6] %}
              {% endif %}
            {% endif %}
          {% endif %}
          
          {% if original_comment %}
            <div class="notification-original">
              <strong>Votre commentaire:</strong> "{{ original_comment|safe }}"
            </div>
          {% endif %}
          
          {% if reply_content %}
            <div class="notification-content">
              <strong>R√©ponse:</strong> "{{ reply_content|safe }}"
            </div>
          {% endif %}
        {% endif %}
      {% elif notif.type == 'reply_on_tweet' %}
        <span>
          <a href="{{ url_for('routes.profile', username=notif.from_user_username) }}">
            {{ notif.from_user_username }}
          </a> a r√©pondu √† un commentaire sur votre tweet.
        </span>
        {% if notif.content %}
          {# Parse the formatted content string #}
          {% set content_str = notif.content %}
          {% set original_comment = '' %}
          {% set reply_content = '' %}
          
          {# Find REPLY_ON_TWEET part #}
          {% if 'REPLY_ON_TWEET:' in content_str %}
            {% set parts = content_str.split('|') %}
            {% if parts|length >= 2 %}
              {# Extract REPLY_ON_TWEET part #}
              {% set reply_on_tweet_part = parts[0] %}
              {% set original_comment = reply_on_tweet_part[15:] %}  {# Remove 'REPLY_ON_TWEET:' #}
              
              {# Remove surrounding quotes #}
              {% if original_comment.startswith("'") and original_comment.endswith("'") %}
                {% set original_comment = original_comment[1:-1] %}
              {% elif original_comment.startswith("\u0027") and original_comment.endswith("\u0027") %}
                {% set original_comment = original_comment[6:-6] %}
              {% endif %}
              
              {# Extract REPLY part #}
              {% set reply_part = parts[1] %}
              {% set reply_content = reply_part[6:] %}  {# Remove 'REPLY:' #}
              
              {% if reply_content.startswith("'") and reply_content.endswith("'") %}
                {% set reply_content = reply_content[1:-1] %}
              {% elif reply_content.startswith("\u0027") and reply_content.endswith("\u0027") %}
                {% set reply_content = reply_content[6:-6] %}
              {% endif %}
            {% endif %}
          {% endif %}
          
          {% if original_comment %}
            <div class="notification-original">
              <strong>Commentaire original:</strong> "{{ original_comment|safe }}"
            </div>
          {% endif %}
          
          {% if reply_content %}
            <div class="notification-content">
              <strong>R√©ponse:</strong> "{{ reply_content|safe }}"
            </div>
          {% endif %}
        {% endif %}
      {% endif %}  <!-- ‚Üê THIS WAS MISSING! -->
      
      <span class="notification-time">{{ notif.created_at | replace('T', ' ') | truncate(16) }}</span>
    </div>
    
    {% if notif.type == 'follow' %}
      <a href="{{ url_for('routes.profile', username=notif.from_user_username) }}" class="view-tweet-btn">
        Voir profil
      </a>
    {% elif notif.type == 'reply' or notif.type == 'reply_on_tweet' %}
      <a href="{{ url_for('routes.feed') }}#tweet-{{ notif.tweet_id }}" class="view-tweet-btn">
        Voir discussion
      </a>
    {% else %}
      <a href="{{ url_for('routes.feed') }}#tweet-{{ notif.tweet_id }}" class="view-tweet-btn">
        Voir
      </a>
    {% endif %}
  </div>
  {% endfor %}
</div>
{% else %}
  <p style="text-align:center; color:var(--muted); margin-top:20px;">
    Vous n'avez aucune notification pour le moment.
  </p>
{% endif %}


</div>
</body>
</html>





<script>
    /*AJAX*/
async function fetchNotifications() {
  const res = await fetch('/notifications');
  const data = await res.json();
  const list = document.getElementById('notificationList');
  list.innerHTML = '';

  data.notifications.forEach(n => {
    const li = document.createElement('li');
    if(n.type === 'like'){
      li.textContent = `${n.from_user} a aim√© votre tweet #${n.tweet_id}`;
    } else if(n.type === 'comment'){
      li.textContent = `${n.from_user} a comment√©: "${n.content}" sur votre tweet #${n.tweet_id}`;
    }
    list.appendChild(li);
  });
}

// Appel toutes les 15 secondes
setInterval(fetchNotifications, 15000);
fetchNotifications();
</script>
  


</div>
</body>
</html>
